<!DOCTYPE html>
<html>
<head>
  <title>LINGUIST 245B Study</title>
  <!-- Load JsPsych -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>

  <!--Load LexTALE Stims-->
  <script src="lextalestims.js"></script>

  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Initialize jsPsych
    const jsPsych = initJsPsych({
        show_progress_bar: true,
        auto_update_progress_bar: true,
        on_finish: function() {
        // Displays data at the end of the experiment
        // Better to comment out for the real experiment so participants aren't confused
        jsPsych.data.displayData();
      }
    });

    const subject_id = jsPsych.randomization.randomID(10);
              const filename = `${subject_id}.csv`;
    
    // We will store each trial in a list called timeline 
    const timeline = [];

    // Language Background Questionnaires
    
    
    
    // LexTALE Language Questionnaire

    // Load stimuli
  const lextale_stimuli = lex_dict['en'].map(stim => {
    return {
        stimulus: stim.word,
        data: {
            correct_response: stim.wstatus === 1 ? 'j' : 'f',
            is_real_word: stim.wstatus === 1
        }
    };
});

// Shuffle stimuli (optional but common)
jsPsych.randomization.shuffle(lextale_stimuli);

// LexTALE instructions
const lex_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    choices: [' '],
    stimulus: `
        <p>This is the LexTALE English vocabulary task.</p>
        <p>You will see a series of words. Some are real English words, others are not.</p>
        <p>Press the <strong>J</strong> key if the word <strong>is a real English word</strong>.</p>
        <p>Press the <strong>F</strong> key if the word <strong>is NOT a real English word</strong>.</p>
        <p>Press the <strong>SPACEBAR</strong> to begin.</p>
    `
};

// Trial template
  const lextale_trials = {
    timeline: [
        {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: function() {
                return `<div style="font-size: 32px;">${jsPsych.timelineVariable('stimulus')}</div>`;
            },
            choices: ['f', 'j'],
            data: jsPsych.timelineVariable('data'),
            on_finish: function(data) {
                data.correct = data.response === data.correct_response;
            }
        }
    ],
    timeline_variables: lextale_stimuli,
    randomize_order: true
  };

  // Finish screen
  const lex_goodbye = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p>Thank you for completing the task!</p><p>Press the spacebar to continue to the experiment task.</p>`
  };

  // Full timeline

  timeline.push(lex_instructions)
  timeline.push(lextale_trials)
  timeline.push(lex_goodbye)


  // Intelligibility Task

    let list_choice = prompt("Choose List (1 or 2):");
    let src = list_choice === "1" ? "List1" : "List2";
  

    // timeline.push({
    // type: jsPsychPreload,
    // images: "assets/pictures",
    // audio: "assets/sounds"
    // });
   
    // Instructions
    const instructions = {
      type: jsPsychInstructions,
      key_forward: ' ',
      pages: ['<div style="width: 60%; margin: auto;"> + <p>Welcome to our experiment. Shortly, you will be presented with some images and auditory recordings.</p> + <p>Please focus on the auditory recordings carefully. Once the audio recording starts playing, start typing in the sentence that you are listening to. Try to be as accurate and as fast as possible.</p> + <p>Press the SPACEBAR to start.</p> </div>']
    };
    
    timeline.push(instructions);
    // Play audio and show image
    timeline.push({
      type: jsPsychAudioKeyboardResponse,
      stimulus: "assets/sounds/American List_1/1.wav",
      prompt: `<img src="assets/pictures/lady1.png" style="max-height: 300px; display: block; margin: 20px auto;">`,
      choices: "NO_KEYS",
      trial_ends_after_audio: true
    });

    timeline.push({
    type: jsPsychSurveyText,
    preamble: `
      <div style="text-align: center;">
        <img src="assets/pictures/lady1.png" style="max-height: 300px;"><br><br>
      </div>
    `,
    questions: [{
      prompt: 'Type the sentence you heard and press ENTER to continue.'
    }],
    choices: ["Enter"],
  });

  
    // Nice to tell participants they are done, thank you, etc
    const completion = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="content"><h2>Thank you!</h2>' +
                '<p>The experiment is now complete.</p>',
      choices: 'NO_KEYS'
    };
    // timeline.push(completion);

    const save_data = {
      type: jsPsychPipe,
      action: "save",
      experiment_id: "FBxlXx5jE1nK",
      filename: filename,
      data_string: ()=>jsPsych.data.get().csv()
    };
    // timeline.push(save_data)

    // This line actually runs the experiment 
    jsPsych.run(timeline);
  </script>
</body>
</html>
