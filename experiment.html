<!DOCTYPE html>
<html>
<head>
  <title>LINGUIST 245B Study</title>
  <!-- Load JsPsych -->
  <script src="https://unpkg.com/jspsych@7.3.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.1.4"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>

  <link href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <script>
    // Initialize jsPsych
    const jsPsych = initJsPsych({
        show_progress_bar: true,
        auto_update_progress_bar: true,
        on_finish: function() {
        // Displays data at the end of the experiment
        // Better to comment out for the real experiment so participants aren't confused
        jsPsych.data.displayData();
      }
    });


    const subject_id = jsPsych.randomization.randomID(10);
              const filename = `${subject_id}.csv`;
    
    // We will store each trial in a list called timeline 
    const timeline = [];

    // Instructions
    const instructions = {
      type: jsPsychInstructions,
      key_forward: ' ',
      pages: ['<div class="content"><h2>Thank you for participating in this study.</h2>' + '<p>For this portion of the experiment, you will be shown a face and will listen to a sentence. After the full sentence is played, type what you heard to the best of your ability. Hit the </strong>SPACEBAR<strong> to begin.</p>']
    
    };
    timeline.push(instructions);

    timeline.push({
    type: jsPsychSurveyText,
    preamble: `
      <div style="text-align: center;">
        <img src="assets/pictures/lady1.png" style="max-height: 300px;"><br><br>
      </div>
    `,
    questions: [{
      prompt: 'Type the sentence you heard and press ENTER to continue.'
    }],
    choices: ["Enter"],
    // on_finish: function(data) {
    //   let textarea = document.querySelector("#input-text");
    //   data.response_text = textarea ? textarea.value : "";
      // data.trial_index = i + 1;
      // data.subject_id = subject_id;
      // data.list_choice = list_choice;
    //}
  });

  
    // Nice to tell participants they are done, thank you, etc
    const completion = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="content"><h2>Thank you!</h2>' +
                '<p>The experiment is now complete.</p>',
      choices: 'NO_KEYS'
    };
    // timeline.push(completion);

    const save_data = {
      type: jsPsychPipe,
      action: "save",
      experiment_id: "FBxlXx5jE1nK",
      filename: filename,
      data_string: ()=>jsPsych.data.get().csv()
    };
    // timeline.push(save_data)

    // This line actually runs the experiment 
    jsPsych.run(timeline);
  </script>
</body>
</html>
